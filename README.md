# FurniSwap - Backend для электронной коммерции поддержанной мебели

Backend API для приложения по продаже и обмену поддержанной мебели, написанный на Go с использованием фреймворка Gin и базы данных PostgreSQL.

## Функциональность

1. **Аутентификация пользователей**:
   - Регистрация с подтверждением по email
   - Вход с двухфакторной аутентификацией
   - Профиль пользователя (имя, email, город, аватар)

2. **Объявления**:
   - Создание, редактирование, удаление объявлений о продаже мебели
   - Фотографии для объявлений
   - Поиск объявлений по различным фильтрам
   - Добавление в избранное

3. **Чаты и сообщения**:
   - Личные сообщения между покупателем и продавцом
   - Просмотр истории сообщений

## Структура проекта

```
FurniSwap/
├── handlers/          # Обработчики HTTP запросов
├── middlewares/       # Middleware, например для аутентификации
├── models/            # Структуры данных
├── utils/             # Вспомогательные функции и утилиты
├── migrations/        # SQL миграции
├── uploads/           # Директория для загруженных изображений
├── main.go            # Точка входа в приложение
├── go.mod             # Описание зависимостей
├── go.sum             # Контрольные суммы зависимостей
├── .env               # Файл с переменными окружения
└── docker-compose.yml # Конфигурация Docker для PostgreSQL
```

## Требования

- Go 1.16+
- PostgreSQL 12+
- Docker и Docker Compose (опционально)

## Настройка и запуск

1. **Клонирование репозитория**:
   ```bash
   git clone https://github.com/yourusername/FurniSwap.git
   cd FurniSwap
   ```

2. **Настройка переменных окружения**:
   ```bash
   cp .env.example .env
   # Отредактируйте .env файл, указав ваши данные
   ```

3. **Запуск PostgreSQL через Docker**:
   ```bash
   docker-compose up -d
   ```

4. **Инициализация базы данных**:
   ```bash
   psql -h localhost -p 5431 -U postgres -d postgres -f migrations/init.sql
   ```

5. **Сборка и запуск приложения**:
   ```bash
   go mod download
   go run main.go
   ```

6. **Сервер будет доступен по адресу**: http://localhost:8080

## API Endpoints

### Аутентификация

- `POST /auth/register` - Регистрация нового пользователя
- `POST /auth/verify` - Проверка кода подтверждения email
- `POST /auth/login` - Вход в систему (отправляет код для второго фактора)
- `POST /auth/verify-2fa` - Проверка двухфакторной аутентификации

### Объявления

- `GET /listings` - Получение списка объявлений с фильтрацией
- `GET /listings/:id` - Получение детальной информации об объявлении
- `POST /api/listings` - Создание нового объявления (требуется аутентификация)
- `PUT /api/listings/:id` - Обновление объявления (требуется аутентификация)
- `DELETE /api/listings/:id` - Удаление объявления (требуется аутентификация)

### Изображения

- `POST /api/listings/:id/images` - Загрузка изображения для объявления
- `DELETE /api/listings/:id/images/:imageId` - Удаление изображения
- `PUT /api/listings/:id/images/:imageId/main` - Установка главного изображения

### Избранное

- `POST /api/listings/:id/favorite` - Добавление объявления в избранное
- `DELETE /api/listings/:id/favorite` - Удаление объявления из избранного
- `GET /api/listings/:id/favorite` - Проверка, добавлено ли объявление в избранное
- `GET /api/favorites` - Получение списка избранных объявлений

### Чаты и сообщения

- `POST /api/chats` - Создание нового чата или отправка сообщения в существующий
- `GET /api/chats` - Получение списка чатов пользователя
- `GET /api/chats/:id` - Получение сообщений в чате
- `POST /api/chats/:id/messages` - Отправка сообщения в чат

### Профиль пользователя

- `GET /api/profile` - Получение профиля пользователя
- `PUT /api/profile` - Обновление профиля пользователя
- `POST /api/profile/avatar` - Загрузка аватара пользователя

## Лицензия

Этот проект распространяется под лицензией MIT. 